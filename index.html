<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LUCAS Agent</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#050505">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="LUCAS">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Urbanist:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- React -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Urbanist', sans-serif;
            background: #050505;
            color: white;
            min-height: 100vh;
            min-height: -webkit-fill-available;
            overflow-x: hidden;
        }
        
        html {
            height: -webkit-fill-available;
        }
        
        #root {
            min-height: 100vh;
            min-height: -webkit-fill-available;
            display: flex;
            flex-direction: column;
        }
        
        /* Utility Classes */
        .lucas-green { color: #deff9a; }
        .bg-lucas-green { background: #deff9a; }
        .bg-dark { background: #050505; }
        .bg-card { background: #111111; }
        .bg-card-hover { background: #1a1a1a; }
        .border-default { border-color: #262626; }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(100%); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        @keyframes success-pop {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }
        
        .slide-up {
            animation: slideUp 0.3s ease-out;
        }
        
        .success-pop {
            animation: success-pop 0.5s ease-out;
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        /* Safe Area for iOS */
        .safe-top {
            padding-top: env(safe-area-inset-top, 20px);
        }
        
        .safe-bottom {
            padding-bottom: env(safe-area-inset-bottom, 20px);
        }
        
        /* Loading spinner */
        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #262626;
            border-top-color: #deff9a;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Camera styles */
        .camera-container {
            position: relative;
            width: 100%;
            flex: 1;
            background: #000;
            border-radius: 16px;
            overflow: hidden;
        }
        
        .camera-container video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .camera-overlay {
            position: absolute;
            bottom: 12px;
            left: 12px;
            right: 12px;
            display: flex;
            justify-content: space-between;
        }
        
        .camera-badge {
            background: rgba(0,0,0,0.7);
            padding: 6px 10px;
            border-radius: 8px;
            font-size: 11px;
            font-family: monospace;
        }
        
        /* Hide scrollbar but allow scroll */
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        
        /* Button press effect */
        .btn-press:active {
            transform: scale(0.97);
        }
        
        /* Input styles */
        input, select, textarea {
            font-family: 'Urbanist', sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('LUCAS SW registered:', registration.scope);
                    })
                    .catch((error) => {
                        console.log('LUCAS SW registration failed:', error);
                    });
            });
        }
    </script>
    
    <script type="text/babel">
        const { useState, useEffect, useRef, createContext, useContext } = React;
        
        // ============================================
        // CONTEXT & STATE MANAGEMENT
        // ============================================
        
        const AppContext = createContext();
        
        const initialState = {
            user: {
                name: 'AgustÃ­n',
                phone: '+52 55 1234 5678',
                balance: 42.50,
                completedTasks: 12
            },
            tasks: [
                {
                    id: 1,
                    type: 'RETAIL',
                    title: 'Verificar Stock Coca-Cola',
                    location: 'OXXO Polanco',
                    address: 'Av. Presidente Masaryk 456',
                    lat: 19.4326,
                    lng: -99.1332,
                    distance: 350,
                    payout: 2.50,
                    instructions: [
                        'Ve a la tienda OXXO indicada',
                        'Encuentra el refrigerador de bebidas',
                        'Toma una foto clara del estante de Coca-Cola',
                        'AsegÃºrate que se vean los precios'
                    ],
                    estimatedTime: '5-10 min'
                },
                {
                    id: 2,
                    type: 'MAPEO',
                    title: 'Foto de Fachada',
                    location: 'Negocio Local',
                    address: 'Calle Anatole France 123, Polanco',
                    lat: 19.4340,
                    lng: -99.1380,
                    distance: 800,
                    payout: 3.00,
                    instructions: [
                        'Ubica la direcciÃ³n indicada',
                        'Toma una foto de la fachada completa',
                        'Incluye el nÃºmero de calle visible',
                        'Si hay negocio, captura el nombre'
                    ],
                    estimatedTime: '5 min'
                },
                {
                    id: 3,
                    type: 'KYB',
                    title: 'Verificar Negocio Activo',
                    location: 'TaquerÃ­a El GÃ¼ero',
                    address: 'Calle Durango 245, Roma Norte',
                    lat: 19.4195,
                    lng: -99.1650,
                    distance: 1200,
                    payout: 4.00,
                    instructions: [
                        'Confirma que el negocio existe',
                        'Verifica que estÃ© abierto/operando',
                        'Toma foto del exterior con el nombre visible',
                        'Si estÃ¡ cerrado, toma foto del letrero de horario'
                    ],
                    estimatedTime: '10 min'
                },
                {
                    id: 4,
                    type: 'RETAIL',
                    title: 'Verificar Precios Sabritas',
                    location: '7-Eleven Reforma',
                    address: 'Paseo de la Reforma 222',
                    lat: 19.4280,
                    lng: -99.1520,
                    distance: 1500,
                    payout: 2.00,
                    instructions: [
                        'Ve a la tienda 7-Eleven',
                        'Encuentra la secciÃ³n de botanas',
                        'FotografÃ­a los precios de Sabritas',
                        'Incluye al menos 3 productos diferentes'
                    ],
                    estimatedTime: '5-10 min'
                }
            ],
            transactions: [
                { id: 1, type: 'earning', title: 'Stock Coca-Cola', location: 'OXXO Polanco', amount: 2.50, time: 'Hace 2 min' },
                { id: 2, type: 'earning', title: 'Verificar Precios', location: 'Reforma', amount: 1.50, time: 'Hace 1 hora' },
                { id: 3, type: 'cashout', title: 'Cash Out a Bitso', amount: -30.00, time: 'Ayer' },
                { id: 4, type: 'earning', title: 'Foto de Fachada', location: 'Condesa', amount: 3.00, time: 'Ayer' }
            ]
        };
        
        // ============================================
        // COMPONENTS
        // ============================================
        
        // Bottom Navigation
        function BottomNav({ activeTab, setActiveTab, setScreen }) {
            const tabs = [
                { id: 'tasks', icon: 'fa-list-check', label: 'Tareas' },
                { id: 'wallet', icon: 'fa-wallet', label: 'Wallet' },
                { id: 'profile', icon: 'fa-user', label: 'Perfil' }
            ];
            
            const handleTabClick = (tabId) => {
                setActiveTab(tabId);
                setScreen(tabId);
            };
            
            return (
                <div className="safe-bottom" style={{
                    position: 'fixed',
                    bottom: 0,
                    left: 0,
                    right: 0,
                    height: '70px',
                    background: '#111',
                    borderTop: '1px solid #262626',
                    display: 'flex',
                    justifyContent: 'space-around',
                    alignItems: 'center',
                    zIndex: 100
                }}>
                    {tabs.map(tab => (
                        <button
                            key={tab.id}
                            onClick={() => handleTabClick(tab.id)}
                            className="btn-press"
                            style={{
                                display: 'flex',
                                flexDirection: 'column',
                                alignItems: 'center',
                                gap: '4px',
                                background: 'none',
                                border: 'none',
                                color: activeTab === tab.id ? '#deff9a' : '#6b7280',
                                fontSize: '10px',
                                cursor: 'pointer',
                                padding: '8px 16px',
                                transition: 'color 0.2s'
                            }}
                        >
                            <i className={`fa-solid ${tab.icon}`} style={{ fontSize: '20px' }}></i>
                            <span style={{ fontWeight: 500 }}>{tab.label}</span>
                        </button>
                    ))}
                </div>
            );
        }
        
        // Task Card
        function TaskCard({ task, onClick }) {
            const typeColors = {
                'RETAIL': '#deff9a',
                'MAPEO': '#60a5fa',
                'KYB': '#f472b6'
            };
            
            const formatDistance = (meters) => {
                if (meters < 1000) return `${meters}m`;
                return `${(meters / 1000).toFixed(1)}km`;
            };
            
            const walkingTime = Math.ceil(task.distance / 80); // ~80m per minute walking
            
            return (
                <div
                    onClick={onClick}
                    className="btn-press fade-in"
                    style={{
                        background: '#1a1a1a',
                        border: '1px solid #262626',
                        borderRadius: '12px',
                        padding: '14px',
                        marginBottom: '10px',
                        cursor: 'pointer',
                        transition: 'border-color 0.2s'
                    }}
                >
                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'start', marginBottom: '8px' }}>
                        <span style={{
                            fontSize: '10px',
                            color: typeColors[task.type],
                            background: `${typeColors[task.type]}15`,
                            padding: '3px 8px',
                            borderRadius: '20px',
                            fontWeight: 600
                        }}>
                            {task.type}
                        </span>
                        <span style={{ fontWeight: 700, color: '#deff9a' }}>${task.payout.toFixed(2)}</span>
                    </div>
                    <div style={{ fontWeight: 600, fontSize: '15px', marginBottom: '6px' }}>{task.title}</div>
                    <div style={{ fontSize: '12px', color: '#6b7280', display: 'flex', alignItems: 'center', gap: '4px' }}>
                        <i className="fa-solid fa-location-dot"></i>
                        {task.location}, {task.address.split(',')[0]}
                    </div>
                    <div style={{ fontSize: '11px', color: '#9ca3af', marginTop: '8px', display: 'flex', alignItems: 'center', gap: '4px' }}>
                        <i className="fa-solid fa-person-walking"></i>
                        {formatDistance(task.distance)} â€¢ ~{walkingTime} min caminando
                    </div>
                </div>
            );
        }
        
        // Tasks Screen
        function TasksScreen({ state, setScreen, setSelectedTask }) {
            return (
                <div className="fade-in" style={{ padding: '20px', paddingBottom: '90px' }}>
                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}>
                        <h2 style={{ fontSize: '22px', fontWeight: 700 }}>Hola, {state.user.name} ðŸ‘‹</h2>
                        <div style={{
                            width: '40px',
                            height: '40px',
                            background: '#262626',
                            borderRadius: '50%',
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: '#deff9a'
                        }}>
                            <i className="fa-solid fa-user"></i>
                        </div>
                    </div>
                    
                    {/* Balance Card */}
                    <div style={{
                        background: 'linear-gradient(135deg, #1a1a1a 0%, #111 100%)',
                        border: '1px solid #262626',
                        borderRadius: '16px',
                        padding: '16px',
                        marginBottom: '24px'
                    }}>
                        <div style={{ fontSize: '11px', color: '#6b7280', textTransform: 'uppercase', letterSpacing: '1px' }}>
                            Tu Balance
                        </div>
                        <div style={{ fontSize: '32px', fontWeight: 800, marginTop: '4px' }}>
                            ${state.user.balance.toFixed(2)} <span style={{ color: '#deff9a', fontSize: '16px', fontWeight: 600 }}>USDT</span>
                        </div>
                        <div style={{ fontSize: '12px', color: '#6b7280', marginTop: '4px' }}>
                            â‰ˆ ${(state.user.balance * 17).toFixed(0)} MXN
                        </div>
                    </div>
                    
                    {/* Tasks Section */}
                    <div style={{ fontSize: '14px', fontWeight: 600, color: '#9ca3af', marginBottom: '12px' }}>
                        Tareas Cercanas ({state.tasks.length})
                    </div>
                    
                    {state.tasks.map(task => (
                        <TaskCard
                            key={task.id}
                            task={task}
                            onClick={() => {
                                setSelectedTask(task);
                                setScreen('taskDetail');
                            }}
                        />
                    ))}
                </div>
            );
        }
        
        // Task Detail Screen
        function TaskDetailScreen({ task, setScreen, setActiveTab }) {
            const openMaps = () => {
                const url = `https://www.google.com/maps/dir/?api=1&destination=${task.lat},${task.lng}`;
                window.open(url, '_blank');
            };
            
            const typeColors = {
                'RETAIL': '#deff9a',
                'MAPEO': '#60a5fa',
                'KYB': '#f472b6'
            };
            
            return (
                <div className="fade-in" style={{ padding: '20px', paddingBottom: '90px' }}>
                    <button
                        onClick={() => {
                            setScreen('tasks');
                            setActiveTab('tasks');
                        }}
                        style={{
                            display: 'flex',
                            alignItems: 'center',
                            gap: '8px',
                            color: '#9ca3af',
                            fontSize: '14px',
                            background: 'none',
                            border: 'none',
                            marginBottom: '16px',
                            cursor: 'pointer'
                        }}
                    >
                        <i className="fa-solid fa-chevron-left"></i>
                        <span>Tareas</span>
                    </button>
                    
                    <div style={{
                        background: '#1a1a1a',
                        border: '1px solid #262626',
                        borderRadius: '16px',
                        padding: '16px',
                        marginBottom: '16px'
                    }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '12px' }}>
                            <span style={{
                                fontSize: '10px',
                                color: typeColors[task.type],
                                background: `${typeColors[task.type]}15`,
                                padding: '3px 8px',
                                borderRadius: '20px',
                                fontWeight: 600
                            }}>
                                {task.type}
                            </span>
                            <span style={{ fontSize: '24px', fontWeight: 800, color: '#deff9a' }}>
                                ${task.payout.toFixed(2)}
                            </span>
                        </div>
                        
                        <h1 style={{ fontSize: '20px', fontWeight: 700, marginBottom: '16px' }}>{task.title}</h1>
                        
                        <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
                            <div style={{ display: 'flex', alignItems: 'start', gap: '10px', fontSize: '13px' }}>
                                <i className="fa-solid fa-location-dot" style={{ color: '#deff9a', marginTop: '3px' }}></i>
                                <div>
                                    <div style={{ color: '#6b7280', fontSize: '11px' }}>UbicaciÃ³n</div>
                                    <div>{task.location}</div>
                                    <div style={{ fontSize: '12px', color: '#6b7280' }}>{task.address}</div>
                                </div>
                            </div>
                            
                            <div style={{ display: 'flex', alignItems: 'start', gap: '10px', fontSize: '13px' }}>
                                <i className="fa-solid fa-clock" style={{ color: '#deff9a', marginTop: '3px' }}></i>
                                <div>
                                    <div style={{ color: '#6b7280', fontSize: '11px' }}>Tiempo estimado</div>
                                    <div>{task.estimatedTime}</div>
                                </div>
                            </div>
                            
                            <div style={{ display: 'flex', alignItems: 'start', gap: '10px', fontSize: '13px' }}>
                                <i className="fa-solid fa-person-walking" style={{ color: '#deff9a', marginTop: '3px' }}></i>
                                <div>
                                    <div style={{ color: '#6b7280', fontSize: '11px' }}>Distancia</div>
                                    <div>{task.distance}m (~{Math.ceil(task.distance / 80)} min caminando)</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    {/* Instructions */}
                    <div style={{
                        background: '#111',
                        borderRadius: '12px',
                        padding: '14px',
                        marginBottom: '20px'
                    }}>
                        <div style={{ fontWeight: 600, marginBottom: '10px', fontSize: '14px' }}>ðŸ“‹ Instrucciones</div>
                        {task.instructions.map((instruction, index) => (
                            <div key={index} style={{
                                fontSize: '13px',
                                color: '#d1d5db',
                                padding: '6px 0',
                                display: 'flex',
                                gap: '8px'
                            }}>
                                <span style={{ color: '#deff9a', fontWeight: 600 }}>{index + 1}.</span>
                                {instruction}
                            </div>
                        ))}
                    </div>
                    
                    {/* Action Buttons */}
                    <button
                        onClick={openMaps}
                        style={{
                            width: '100%',
                            padding: '14px',
                            background: '#262626',
                            color: 'white',
                            border: 'none',
                            borderRadius: '12px',
                            fontSize: '14px',
                            fontWeight: 600,
                            marginBottom: '10px',
                            cursor: 'pointer',
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            gap: '8px'
                        }}
                        className="btn-press"
                    >
                        <i className="fa-solid fa-route"></i>
                        Abrir en Google Maps
                    </button>
                    
                    <button
                        onClick={() => setScreen('camera')}
                        style={{
                            width: '100%',
                            padding: '16px',
                            background: '#deff9a',
                            color: '#050505',
                            border: 'none',
                            borderRadius: '12px',
                            fontSize: '15px',
                            fontWeight: 700,
                            cursor: 'pointer',
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            gap: '8px'
                        }}
                        className="btn-press"
                    >
                        <i className="fa-solid fa-camera"></i>
                        Tomar Foto
                    </button>
                </div>
            );
        }
        
        // Camera Screen - Uses native camera for iOS compatibility
        function CameraScreen({ task, setScreen, setCapturedImage, setGpsData }) {
            const fileInputRef = useRef(null);
            const canvasRef = useRef(null);
            const [location, setLocation] = useState(null);
            const [isProcessing, setIsProcessing] = useState(false);
            
            useEffect(() => {
                // Get GPS location
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            setLocation({
                                lat: position.coords.latitude.toFixed(4),
                                lng: position.coords.longitude.toFixed(4)
                            });
                        },
                        (error) => {
                            console.log('GPS error:', error);
                            // Use task location as fallback
                            setLocation({ lat: task.lat.toFixed(4), lng: task.lng.toFixed(4) });
                        },
                        { enableHighAccuracy: true }
                    );
                }
            }, []);
            
            const handleFileSelect = async (event) => {
                const file = event.target.files[0];
                if (!file) return;
                
                setIsProcessing(true);
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = canvasRef.current;
                        const maxWidth = 1920;
                        const maxHeight = 1080;
                        let { width, height } = img;
                        
                        // Scale down if needed
                        if (width > maxWidth || height > maxHeight) {
                            const ratio = Math.min(maxWidth / width, maxHeight / height);
                            width *= ratio;
                            height *= ratio;
                        }
                        
                        canvas.width = width;
                        canvas.height = height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);
                        
                        // Add GPS/timestamp overlay
                        const timestamp = new Date().toISOString().slice(0, 19).replace('T', ' ');
                        const lat = location?.lat || task.lat.toFixed(4);
                        const lng = location?.lng || task.lng.toFixed(4);
                        
                        ctx.fillStyle = 'rgba(0,0,0,0.7)';
                        ctx.fillRect(10, height - 80, 320, 70);
                        ctx.fillStyle = '#deff9a';
                        ctx.font = 'bold 16px monospace';
                        ctx.fillText(`ðŸ“ ${lat}Â°, ${lng}Â°`, 20, height - 50);
                        ctx.fillStyle = 'white';
                        ctx.fillText(`ðŸ• ${timestamp}`, 20, height - 25);
                        
                        const imageData = canvas.toDataURL('image/jpeg', 0.8);
                        setCapturedImage(imageData);
                        setGpsData({ lat, lng, timestamp });
                        setIsProcessing(false);
                        setScreen('review');
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            };
            
            const openCamera = () => {
                fileInputRef.current?.click();
            };
            
            return (
                <div style={{ 
                    display: 'flex', 
                    flexDirection: 'column', 
                    height: '100vh',
                    padding: '20px',
                    paddingTop: 'max(20px, env(safe-area-inset-top))'
                }}>
                    <button
                        onClick={() => setScreen('taskDetail')}
                        style={{
                            display: 'flex',
                            alignItems: 'center',
                            gap: '8px',
                            color: '#9ca3af',
                            fontSize: '14px',
                            background: 'none',
                            border: 'none',
                            marginBottom: '16px',
                            cursor: 'pointer'
                        }}
                    >
                        <i className="fa-solid fa-chevron-left"></i>
                        <span>Cancelar</span>
                    </button>
                    
                    {/* Hidden file input for native camera */}
                    <input
                        ref={fileInputRef}
                        type="file"
                        accept="image/*"
                        capture="environment"
                        onChange={handleFileSelect}
                        style={{ display: 'none' }}
                    />
                    
                    <canvas ref={canvasRef} style={{ display: 'none' }} />
                    
                    <div style={{ 
                        flex: 1, 
                        display: 'flex', 
                        flexDirection: 'column',
                        alignItems: 'center', 
                        justifyContent: 'center',
                        background: '#111',
                        borderRadius: '16px',
                        marginBottom: '16px',
                        padding: '40px 20px',
                        textAlign: 'center'
                    }}>
                        {isProcessing ? (
                            <>
                                <div className="spinner" style={{ marginBottom: '16px' }}></div>
                                <div style={{ color: '#9ca3af' }}>Procesando foto...</div>
                            </>
                        ) : (
                            <>
                                <div style={{
                                    width: '100px',
                                    height: '100px',
                                    background: 'rgba(222, 255, 154, 0.1)',
                                    borderRadius: '50%',
                                    display: 'flex',
                                    alignItems: 'center',
                                    justifyContent: 'center',
                                    marginBottom: '24px'
                                }}>
                                    <i className="fa-solid fa-camera" style={{ fontSize: '40px', color: '#deff9a' }}></i>
                                </div>
                                
                                <h3 style={{ fontSize: '18px', fontWeight: 600, marginBottom: '8px' }}>
                                    Tomar Foto
                                </h3>
                                <p style={{ color: '#6b7280', fontSize: '14px', marginBottom: '8px' }}>
                                    {task.instructions[2]}
                                </p>
                                
                                <div style={{ 
                                    display: 'flex', 
                                    alignItems: 'center', 
                                    gap: '6px',
                                    color: '#deff9a',
                                    fontSize: '12px',
                                    marginTop: '16px'
                                }}>
                                    <i className="fa-solid fa-location-dot"></i>
                                    <span>GPS: {location ? `${location.lat}Â°, ${location.lng}Â°` : 'Obteniendo...'}</span>
                                </div>
                            </>
                        )}
                    </div>
                    
                    <button
                        onClick={openCamera}
                        disabled={isProcessing}
                        className="btn-press"
                        style={{
                            width: '100%',
                            padding: '18px',
                            background: isProcessing ? '#333' : '#deff9a',
                            color: '#050505',
                            border: 'none',
                            borderRadius: '12px',
                            fontSize: '16px',
                            fontWeight: 700,
                            cursor: isProcessing ? 'wait' : 'pointer',
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            gap: '10px',
                            marginBottom: '20px'
                        }}
                    >
                        <i className="fa-solid fa-camera"></i>
                        Abrir CÃ¡mara
                    </button>
                </div>
            );
        }
        
        // Review Screen
        function ReviewScreen({ task, capturedImage, gpsData, setScreen, setState, state }) {
            const [isSubmitting, setIsSubmitting] = useState(false);
            
            const handleSubmit = () => {
                setIsSubmitting(true);
                
                // Simulate submission delay
                setTimeout(() => {
                    // Update state with new balance and transaction
                    setState(prev => ({
                        ...prev,
                        user: {
                            ...prev.user,
                            balance: prev.user.balance + task.payout,
                            completedTasks: prev.user.completedTasks + 1
                        },
                        transactions: [
                            {
                                id: Date.now(),
                                type: 'earning',
                                title: task.title,
                                location: task.location,
                                amount: task.payout,
                                time: 'Justo ahora'
                            },
                            ...prev.transactions
                        ],
                        tasks: prev.tasks.filter(t => t.id !== task.id)
                    }));
                    
                    setScreen('success');
                }, 1500);
            };
            
            return (
                <div className="fade-in" style={{ padding: '20px', paddingBottom: '40px' }}>
                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}>
                        <h2 style={{ fontSize: '20px', fontWeight: 700 }}>Revisar EnvÃ­o</h2>
                    </div>
                    
                    {/* Image Preview */}
                    <div style={{
                        width: '100%',
                        height: '200px',
                        borderRadius: '12px',
                        overflow: 'hidden',
                        marginBottom: '16px',
                        position: 'relative'
                    }}>
                        <img
                            src={capturedImage}
                            alt="Captured"
                            style={{ width: '100%', height: '100%', objectFit: 'cover' }}
                        />
                        <div style={{
                            position: 'absolute',
                            top: '10px',
                            right: '10px',
                            background: '#deff9a',
                            color: '#050505',
                            fontSize: '11px',
                            fontWeight: 600,
                            padding: '4px 10px',
                            borderRadius: '6px'
                        }}>
                            <i className="fa-solid fa-check"></i> Foto capturada
                        </div>
                    </div>
                    
                    {/* Verification Checklist */}
                    <div style={{ marginBottom: '20px' }}>
                        {[
                            { icon: 'fa-circle-check', label: 'GPS verificado', value: `${gpsData.lat}Â°, ${gpsData.lng}Â°` },
                            { icon: 'fa-circle-check', label: 'Timestamp', value: gpsData.timestamp + ' UTC' },
                            { icon: 'fa-circle-check', label: 'Foto de alta calidad', value: 'ResoluciÃ³n: 1920x1080' },
                            { icon: 'fa-hourglass-half', label: 'VerificaciÃ³n AI', value: 'Se verificarÃ¡ al enviar', pending: true }
                        ].map((item, index) => (
                            <div key={index} style={{
                                display: 'flex',
                                alignItems: 'center',
                                gap: '10px',
                                padding: '12px 0',
                                borderBottom: '1px solid #262626'
                            }}>
                                <i className={`fa-solid ${item.icon}`} style={{ color: item.pending ? '#f59e0b' : '#deff9a' }}></i>
                                <div>
                                    <div style={{ fontSize: '14px' }}>{item.label}</div>
                                    <div style={{ fontSize: '11px', color: '#6b7280' }}>{item.value}</div>
                                </div>
                            </div>
                        ))}
                    </div>
                    
                    {/* Action Buttons */}
                    <button
                        onClick={() => setScreen('camera')}
                        style={{
                            width: '100%',
                            padding: '14px',
                            background: '#262626',
                            color: 'white',
                            border: 'none',
                            borderRadius: '12px',
                            fontSize: '14px',
                            fontWeight: 600,
                            marginBottom: '10px',
                            cursor: 'pointer'
                        }}
                        className="btn-press"
                    >
                        <i className="fa-solid fa-camera"></i> Tomar otra foto
                    </button>
                    
                    <button
                        onClick={handleSubmit}
                        disabled={isSubmitting}
                        style={{
                            width: '100%',
                            padding: '16px',
                            background: isSubmitting ? '#a3c261' : '#deff9a',
                            color: '#050505',
                            border: 'none',
                            borderRadius: '12px',
                            fontSize: '15px',
                            fontWeight: 700,
                            cursor: isSubmitting ? 'wait' : 'pointer',
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            gap: '8px'
                        }}
                        className="btn-press"
                    >
                        {isSubmitting ? (
                            <>
                                <div className="spinner" style={{ width: '20px', height: '20px', borderWidth: '2px' }}></div>
                                Enviando...
                            </>
                        ) : (
                            <>
                                <i className="fa-solid fa-paper-plane"></i>
                                Enviar VerificaciÃ³n
                            </>
                        )}
                    </button>
                </div>
            );
        }
        
        // Success Screen
        function SuccessScreen({ task, setScreen, setActiveTab, setSelectedTask }) {
            return (
                <div style={{
                    display: 'flex',
                    flexDirection: 'column',
                    alignItems: 'center',
                    justifyContent: 'center',
                    minHeight: '100vh',
                    padding: '40px 20px',
                    textAlign: 'center'
                }}>
                    <div className="success-pop" style={{
                        width: '100px',
                        height: '100px',
                        background: 'rgba(222, 255, 154, 0.15)',
                        borderRadius: '50%',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        marginBottom: '24px'
                    }}>
                        <i className="fa-solid fa-check" style={{ fontSize: '48px', color: '#deff9a' }}></i>
                    </div>
                    
                    <h1 style={{ fontSize: '24px', fontWeight: 700, marginBottom: '8px' }}>Â¡VerificaciÃ³n Completa!</h1>
                    <p style={{ color: '#9ca3af', fontSize: '15px', marginBottom: '32px' }}>Tu pago estÃ¡ en camino</p>
                    
                    <div style={{ fontSize: '48px', fontWeight: 800, color: '#deff9a', marginBottom: '4px' }}>
                        +${task.payout.toFixed(2)} USDT
                    </div>
                    <div style={{ color: '#6b7280', fontSize: '13px', marginBottom: '40px' }}>
                        Agregado a tu wallet
                    </div>
                    
                    <button
                        onClick={() => {
                            setSelectedTask(null);
                            setActiveTab('tasks');
                            setScreen('tasks');
                        }}
                        style={{
                            width: '100%',
                            maxWidth: '300px',
                            padding: '16px',
                            background: '#deff9a',
                            color: '#050505',
                            border: 'none',
                            borderRadius: '12px',
                            fontSize: '15px',
                            fontWeight: 700,
                            cursor: 'pointer',
                            marginBottom: '12px'
                        }}
                        className="btn-press"
                    >
                        Ver MÃ¡s Tareas
                    </button>
                    
                    <button
                        onClick={() => {
                            setSelectedTask(null);
                            setActiveTab('wallet');
                            setScreen('wallet');
                        }}
                        style={{
                            width: '100%',
                            maxWidth: '300px',
                            padding: '14px',
                            background: '#262626',
                            color: 'white',
                            border: 'none',
                            borderRadius: '12px',
                            fontSize: '14px',
                            fontWeight: 600,
                            cursor: 'pointer'
                        }}
                        className="btn-press"
                    >
                        Ir a Wallet
                    </button>
                </div>
            );
        }
        
        // Wallet Screen
        function WalletScreen({ state }) {
            return (
                <div className="fade-in" style={{ padding: '20px', paddingBottom: '90px' }}>
                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}>
                        <h2 style={{ fontSize: '22px', fontWeight: 700 }}>Wallet</h2>
                        <div style={{
                            width: '40px',
                            height: '40px',
                            background: '#262626',
                            borderRadius: '50%',
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: '#deff9a'
                        }}>
                            <i className="fa-solid fa-user"></i>
                        </div>
                    </div>
                    
                    {/* Balance Card */}
                    <div style={{
                        background: 'linear-gradient(135deg, #1a2f1a 0%, #111 100%)',
                        border: '1px solid #2d4a2d',
                        borderRadius: '20px',
                        padding: '24px',
                        textAlign: 'center',
                        marginBottom: '20px'
                    }}>
                        <div style={{ fontSize: '11px', color: '#6b7280', textTransform: 'uppercase', letterSpacing: '1px' }}>
                            Balance Total
                        </div>
                        <div style={{ fontSize: '40px', fontWeight: 800, margin: '8px 0' }}>
                            ${state.user.balance.toFixed(2)} <span style={{ color: '#deff9a', fontSize: '18px' }}>USDT</span>
                        </div>
                        <div style={{ fontSize: '13px', color: '#6b7280' }}>
                            â‰ˆ ${(state.user.balance * 17).toFixed(0)} MXN
                        </div>
                    </div>
                    
                    {/* Action Buttons */}
                    <div style={{ display: 'flex', gap: '10px', marginBottom: '24px' }}>
                        <button
                            className="btn-press"
                            style={{
                                flex: 1,
                                padding: '14px',
                                background: '#deff9a',
                                color: '#050505',
                                border: 'none',
                                borderRadius: '12px',
                                fontSize: '14px',
                                fontWeight: 600,
                                cursor: 'pointer'
                            }}
                        >
                            <i className="fa-solid fa-arrow-up"></i> Cash Out
                        </button>
                        <button
                            className="btn-press"
                            style={{
                                flex: 1,
                                padding: '14px',
                                background: '#262626',
                                color: 'white',
                                border: 'none',
                                borderRadius: '12px',
                                fontSize: '14px',
                                fontWeight: 600,
                                cursor: 'pointer'
                            }}
                        >
                            <i className="fa-solid fa-clock-rotate-left"></i> Historial
                        </button>
                    </div>
                    
                    {/* Transactions */}
                    <div style={{ fontSize: '14px', fontWeight: 600, color: '#9ca3af', marginBottom: '12px' }}>
                        Actividad Reciente
                    </div>
                    
                    {state.transactions.map(tx => (
                        <div key={tx.id} style={{
                            display: 'flex',
                            justifyContent: 'space-between',
                            alignItems: 'center',
                            padding: '14px 0',
                            borderBottom: '1px solid #1a1a1a'
                        }}>
                            <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                                <div style={{
                                    width: '40px',
                                    height: '40px',
                                    background: tx.type === 'earning' ? 'rgba(222, 255, 154, 0.1)' : 'rgba(239, 68, 68, 0.1)',
                                    borderRadius: '10px',
                                    display: 'flex',
                                    alignItems: 'center',
                                    justifyContent: 'center',
                                    color: tx.type === 'earning' ? '#deff9a' : '#ef4444'
                                }}>
                                    <i className={`fa-solid ${tx.type === 'earning' ? 'fa-check' : 'fa-arrow-up'}`}></i>
                                </div>
                                <div>
                                    <div style={{ fontWeight: 600, fontSize: '14px' }}>{tx.title}</div>
                                    <div style={{ fontSize: '11px', color: '#6b7280' }}>
                                        {tx.time}{tx.location ? ` â€¢ ${tx.location}` : ''}
                                    </div>
                                </div>
                            </div>
                            <div style={{
                                fontWeight: 700,
                                color: tx.type === 'earning' ? '#deff9a' : '#ef4444'
                            }}>
                                {tx.type === 'earning' ? '+' : ''}${Math.abs(tx.amount).toFixed(2)}
                            </div>
                        </div>
                    ))}
                </div>
            );
        }
        
        // Profile Screen
        function ProfileScreen({ state }) {
            return (
                <div className="fade-in" style={{ padding: '20px', paddingBottom: '90px' }}>
                    <h2 style={{ fontSize: '22px', fontWeight: 700, marginBottom: '24px' }}>Perfil</h2>
                    
                    {/* Avatar & Name */}
                    <div style={{ display: 'flex', alignItems: 'center', gap: '16px', marginBottom: '24px' }}>
                        <div style={{
                            width: '70px',
                            height: '70px',
                            background: 'linear-gradient(135deg, #deff9a 0%, #a3c261 100%)',
                            borderRadius: '50%',
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            fontSize: '28px',
                            color: '#050505',
                            fontWeight: 700
                        }}>
                            {state.user.name.charAt(0)}
                        </div>
                        <div>
                            <div style={{ fontSize: '20px', fontWeight: 700 }}>{state.user.name}</div>
                            <div style={{ color: '#6b7280', fontSize: '14px' }}>{state.user.phone}</div>
                        </div>
                    </div>
                    
                    {/* Stats */}
                    <div style={{
                        display: 'grid',
                        gridTemplateColumns: '1fr 1fr',
                        gap: '12px',
                        marginBottom: '24px'
                    }}>
                        <div style={{
                            background: '#1a1a1a',
                            borderRadius: '12px',
                            padding: '16px',
                            textAlign: 'center'
                        }}>
                            <div style={{ fontSize: '28px', fontWeight: 800, color: '#deff9a' }}>
                                {state.user.completedTasks}
                            </div>
                            <div style={{ fontSize: '12px', color: '#6b7280' }}>Tareas completadas</div>
                        </div>
                        <div style={{
                            background: '#1a1a1a',
                            borderRadius: '12px',
                            padding: '16px',
                            textAlign: 'center'
                        }}>
                            <div style={{ fontSize: '28px', fontWeight: 800 }}>
                                ${state.user.balance.toFixed(0)}
                            </div>
                            <div style={{ fontSize: '12px', color: '#6b7280' }}>USDT ganados</div>
                        </div>
                    </div>
                    
                    {/* Menu Items */}
                    {[
                        { icon: 'fa-wallet', label: 'Wallet conectado', value: '0x7a3...4f2c' },
                        { icon: 'fa-bell', label: 'Notificaciones', value: 'Activadas' },
                        { icon: 'fa-language', label: 'Idioma', value: 'EspaÃ±ol' },
                        { icon: 'fa-circle-question', label: 'Ayuda', value: '' },
                        { icon: 'fa-file-contract', label: 'TÃ©rminos y condiciones', value: '' }
                    ].map((item, index) => (
                        <div key={index} style={{
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'space-between',
                            padding: '14px 0',
                            borderBottom: '1px solid #1a1a1a',
                            cursor: 'pointer'
                        }}>
                            <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                                <i className={`fa-solid ${item.icon}`} style={{ color: '#deff9a', width: '20px' }}></i>
                                <span>{item.label}</span>
                            </div>
                            <div style={{ display: 'flex', alignItems: 'center', gap: '8px', color: '#6b7280' }}>
                                <span style={{ fontSize: '13px' }}>{item.value}</span>
                                <i className="fa-solid fa-chevron-right" style={{ fontSize: '12px' }}></i>
                            </div>
                        </div>
                    ))}
                    
                    {/* Logout */}
                    <button style={{
                        width: '100%',
                        padding: '14px',
                        background: 'transparent',
                        color: '#ef4444',
                        border: '1px solid #ef444433',
                        borderRadius: '12px',
                        fontSize: '14px',
                        fontWeight: 600,
                        marginTop: '24px',
                        cursor: 'pointer'
                    }}>
                        <i className="fa-solid fa-right-from-bracket"></i> Cerrar SesiÃ³n
                    </button>
                    
                    {/* App Version */}
                    <div style={{ textAlign: 'center', marginTop: '24px', color: '#4b5563', fontSize: '12px' }}>
                        LUCAS Agent v1.0.0 (Pilot)
                    </div>
                </div>
            );
        }
        
        // ============================================
        // MAIN APP
        // ============================================
        
        function App() {
            const [state, setState] = useState(initialState);
            const [screen, setScreen] = useState('tasks');
            const [activeTab, setActiveTab] = useState('tasks');
            const [selectedTask, setSelectedTask] = useState(null);
            const [capturedImage, setCapturedImage] = useState(null);
            const [gpsData, setGpsData] = useState(null);
            
            const showBottomNav = ['tasks', 'wallet', 'profile'].includes(screen);
            
            return (
                <div className="safe-top" style={{ minHeight: '100vh', background: '#050505' }}>
                    {screen === 'tasks' && (
                        <TasksScreen
                            state={state}
                            setScreen={setScreen}
                            setSelectedTask={setSelectedTask}
                        />
                    )}
                    
                    {screen === 'taskDetail' && selectedTask && (
                        <TaskDetailScreen
                            task={selectedTask}
                            setScreen={setScreen}
                            setActiveTab={setActiveTab}
                        />
                    )}
                    
                    {screen === 'camera' && selectedTask && (
                        <CameraScreen
                            task={selectedTask}
                            setScreen={setScreen}
                            setCapturedImage={setCapturedImage}
                            setGpsData={setGpsData}
                        />
                    )}
                    
                    {screen === 'review' && selectedTask && capturedImage && (
                        <ReviewScreen
                            task={selectedTask}
                            capturedImage={capturedImage}
                            gpsData={gpsData}
                            setScreen={setScreen}
                            setState={setState}
                            state={state}
                        />
                    )}
                    
                    {screen === 'success' && selectedTask && (
                        <SuccessScreen
                            task={selectedTask}
                            setScreen={setScreen}
                            setActiveTab={setActiveTab}
                            setSelectedTask={setSelectedTask}
                        />
                    )}
                    
                    {screen === 'wallet' && (
                        <WalletScreen state={state} />
                    )}
                    
                    {screen === 'profile' && (
                        <ProfileScreen state={state} />
                    )}
                    
                    {showBottomNav && (
                        <BottomNav
                            activeTab={activeTab}
                            setActiveTab={setActiveTab}
                            setScreen={setScreen}
                        />
                    )}
                </div>
            );
        }
        
        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
